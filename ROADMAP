• Roadmap Checklist

  Phase 1 — Data Model & Core Types (highest priority)

  - [ ] Expand atlas_relays schema to include all inline lifecycle metadata required by Payload
    Capture + Archiving PRDs (attempt counters, timing columns, route and delivery identifiers,
    response truncation fields, status timestamps, archived flags, etc.); current migration database/
    migrations/2024_01_01_000000_create_atlas_relays_table.php:12 only stores a subset.
  - [ ] Mirror the live schema (including new metadata) onto atlas_relay_archives so records can move 1:1
    per Archiving PRD; file database/migrations/2024_01_01_000300_create_atlas_relay_archives_table.php:12
    lacks parity and inline observability columns.
  - [ ] Define the authoritative Enums\RelayFailure enum (codes 100–207) with helpers for labels/
    descriptions, and make sure database columns use it consistently (currently absent anywhere in src/).
  - [ ] Flesh out Eloquent models (e.g., src/Models/Relay.php:7) with casts, accessors, scopes, and guarded
    data to enforce stateless, package-isolated behavior the PRDs expect.
  - [ ] Ensure configuration exposes all table names and lifecycle tunables (route cache TTL, retry/delay
    defaults, automation cadences); config/atlas-relay.php:6 currently covers only table names + archive
    settings.

  Phase 2 — Capture & Builder Orchestration

  - [ ] Implement the persistence layer that the RelayBuilder stubs (e.g., src/RelayBuilder.php:34) need:
    validate/mask headers, enforce payload size, set initial statuses, and write to atlas_relays.
  - [ ] Add fluent APIs for setting relay mode, retry/delay/timeout overrides, metadata, and validation
    errors so PRD-defined flows (request→payload→event/dispatch/http) produce deterministic records.
  - [ ] Build a capture service that hydrates RelayContext data, normalizes headers, and plugs into builder
    entrypoints (currently RelayContext is only a snapshot helper in src/Support/RelayContext.php:11).
  - [ ] Provide cancellation/replay utilities aligned with lifecycle rules (Queued → Processing →
    Completed/Failed/Cancelled) defined in PRDs.

  Phase 3 — Routing System

  - [ ] Implement the auto-routing resolver that reads atlas_relay_routes (migration exists at database/
    migrations/2024_01_01_000200_create_atlas_relay_routes_table.php:12) and matches static, dynamic, and
    programmatic routes with caching + invalidation per PRD-Routing.md.
  - [ ] Support programmatic providers with a contract (RoutingProviderInterface) plus registration APIs,
    route context DTOs, and cache controls.
  - [ ] Copy route defaults (retry/delay/timeout flags, headers, identifiers) into relay records at capture
    time, ensuring API overrides win.
  - [ ] Emit NO_ROUTE_MATCH, ROUTE_DISABLED, and resolver error failure reasons when routing fails,
    updating the relay before returning control.
  - [ ] Include exhaustive tests for static/dynamic path resolution, cache hits, invalidation, and provider
    precedence.

  Phase 4 — Outbound Delivery Wrappers

  - [ ] Build the HTTP delivery wrapper that proxies Laravel’s Http facade, enforces HTTPS/redirect rules,
    captures response_status/response_payload, maps transport errors to RelayFailure, and surfaces native
    responses.
  - [ ] Implement synchronous event() execution that records completion/failure states and bubbles
    exceptions with mapped failure_reason.
  - [ ] Implement dispatch wrappers (dispatch, dispatchSync, dispatchChain) that return Laravel’s native
    PendingDispatch / Bus chain handles (per docs/PRD/PRD-Example-Usage.md) while attaching middleware to
    update relay state on success/failure.
  - [ ] Add helper APIs for manual job failure signaling, custom failure reasons, and instrumentation
    hooks.
  - [ ] Capture timing/attempt metrics for each outbound execution, storing them inline and emitting events
    for observability.

  Phase 5 — Automation & Reliability Jobs

  - [ ] Create scheduled commands/jobs for retrying overdue relays (every minute), re-queueing stuck
    Processing relays (10 min), and timeout enforcement (hourly) as defined in docs/PRD/PRD-Atlas-Relay.md.
  - [ ] Implement archiving + purge commands that chunk-relays into atlas_relay_archives, verify integrity,
    delete originals, and purge aged archives per docs/PRD/PRD-Archiving-and-Logging.md.
  - [ ] Provide configuration + scheduler bindings (e.g., Laravel console kernel instructions) so consuming
    apps can register the automation cadence easily.
  - [ ] Add telemetry counters (archived, purged, retried counts/durations) for operational monitoring.

  Phase 6 — Observability, Testing, and DX

  - [ ] Add domain events/logging hooks so external systems can subscribe to relay lifecycle milestones
    without database polling.
  - [ ] Build comprehensive PHPUnit/Pest coverage for every subsystem (capture validation, routing
    matrix, outbound wrappers, automation jobs, config overrides). Current tests (tests/Feature/
    RelayFacadeTest.php:13 and tests/Feature/MigrationRegistrationTest.php:13) only cover facades +
    migrations.
  - [ ] Expand README/PRD cross-links with implementation notes, and deliver usage guides per mode (HTTP,
    event, dispatch, autoroute).
  - [ ] Provide artisan commands or support classes for seeding routes, inspecting relay states, and
    replaying archived relays if restoration becomes a requirement.
  - [ ] Document upgrade/migration steps, including how to publish configs/migrations and run automation
    jobs within host apps.

  This ordered checklist surfaces every major build item the PRDs demand while reflecting what the
  current code base already offers (migrations, facades, service provider) versus what still needs to be
  implemented.